jQuery(document).ready(function(){jQuery("body").bind("ulimate_member_gallery_updated",function(){"undefined"!=typeof jQuery.fn.prettyPhoto&&jQuery("a[data-rel='prettyphoto']").prettyPhoto()}),jQuery(document).on("click",'a[data-modal^="umgallery_"], span[data-modal^="umgallery_"], .um-modal a',function(e){return e.preventDefault(),!1}),jQuery(document).on("click","a.umg-manual-trigger",function(){var e=jQuery(this).attr("data-child"),a=jQuery(this).attr("data-parent");jQuery(this).parents(a).find(e).data("modal_t",jQuery(this).data("modal_t")).trigger("click")}),jQuery(document).on("click",'a[data-modal^="umgallery_"], span[data-modal^="umgallery_"]',function(){var e="um_upload_single",a=jQuery(this).data("modal_t");if(jQuery(this).data("modal-size"))var r=jQuery(this).data("modal-size");else var r="normal";jQuery("#"+e).html(jQuery(this).parents(".um-field").find(".um-modal-hidden-content."+a).html()),jQuery(this).parents(".um-profile-photo").attr("data-user_id")&&jQuery("#"+e).attr("data-user_id",jQuery(this).parents(".um-profile-photo").attr("data-user_id")),jQuery(this).parents(".um-cover").attr("data-ratio")&&jQuery("#"+e).attr("data-ratio",jQuery(this).parents(".um-cover").attr("data-ratio")),jQuery(this).parents(".um-cover").attr("data-user_id")&&jQuery("#"+e).attr("data-user_id",jQuery(this).parents(".um-cover").attr("data-user_id"));var t=jQuery("body").find(".um-modal-overlay");0==t.length&&(jQuery(".tipsy").hide(),UM_hide_menus(),jQuery("body,html,textarea").css("overflow","hidden"),jQuery(document).bind("touchmove",function(e){e.preventDefault()}),jQuery(".um-modal").on("touchmove",function(e){e.stopPropagation()}),jQuery("body").append('<div class="um-modal-overlay" /><div class="um-modal no-photo" />'),jQuery("#"+e).prependTo(".um-modal"),jQuery("#"+e).show(),jQuery(".um-modal").show(),um_modal_size(r),"url"==a?(trigger=jQuery(".um-modal:visible").find(".um-modal-form"),trigger.find('[name="embed_video"]').on("focus",function(){trigger.find(".um-error-block").remove()}),trigger.find(".um-finish-upload.url").on("click",function(e){e.preventDefault();var a=trigger.find('[name="embed_video"]').data("key"),r=trigger.find('[name="embed_video"]').val();if(trigger.find(".um-error-block").remove(),""==r)return trigger.find(".form-elem").append('<div class="um-error-block">Video url field is empty.</div>'),!1;var t=new RegExp(/^(https?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[-a-z\d%_.~+]*)*(\?[;&a-z\d%_.~+=-]*)?(\#[-a-z\d_]*)?$/i);if(!t.test(r))return trigger.find(".form-elem").append('<div class="um-error-block">It does not seem like a valid url.</div>'),!1;var d={action:"ultimatemembergallery_video_from_url",key:a,value:r};return jQuery.post(um_gallery_scripts.umg_admin_ajax,d,function(e){"1111"==e?window.location.reload():trigger.find(".form-elem").append('<div class="um-error-block">Failed to save. Please try again</div>'),um_modal_responsive()}),!1}),um_modal_responsive()):"upload"==a&&(trigger=jQuery(".um-modal:visible").find(".um-gallery-image-upload"),upload_help_text=trigger.data("upload_help_text")?'<span class="help">'+trigger.data("upload_help_text")+"</span>":"",icon=trigger.data("icon")?'<span class="icon"><i class="'+trigger.data("icon")+'"></i></span>':"",upload_text=trigger.data("upload_text")?'<span class="str">'+trigger.data("upload_text")+"</span>":"",trigger.uploadFile({url:um_gallery_scripts.galleryimageupload,method:"POST",multiple:!0,sequential:!0,serialize:!0,formData:{key:trigger.data("key"),set_id:trigger.data("set_id"),set_mode:trigger.data("set_mode"),type:trigger.data("gallery_type")},fileName:trigger.data("key"),allowedTypes:trigger.data("allowed_types"),maxFileSize:trigger.data("max_size"),dragDropStr:icon+upload_text+upload_help_text,sizeErrorStr:trigger.data("max_size_error"),extErrorStr:trigger.data("extension_error"),maxFileCountErrorStr:trigger.data("max_files_error"),showDelete:!1,showAbort:!1,showDone:!1,showFileCounter:!1,showStatusAfterSuccess:!0,afterUploadAll:function(){trigger.parents(".um-modal-body").find(".ajax-upload-dragdrop,.upload-statusbar,.filetypetip").hide(0),trigger.parents(".um-modal-body").find(".um-image-preview").show(0),"boolean"==typeof jQuery.ajaxSettings.async&&(jQuery.ajaxSettings.async=!0)},onSubmit:function(){trigger.parents(".um-modal-body").find(".um-error-block").remove(),trigger.parents(".um-modal").removeClass("normal").addClass("large")},onSuccess:function(e,a){trigger.selectedFiles=0,a=jQuery.parseJSON(a),a.error&&""!=a.error?(trigger.parents(".um-modal-body").append('<div class="um-error-block">'+a.error+"</div>"),trigger.parents(".um-modal-body").find(".upload-statusbar").hide(0),um_modal_responsive()):a.reload?window.location.reload():jQuery.each(a,function(e,a){var r=jQuery('<img style="margin:5px" src=\''+a.src+"' />"),t=trigger.parents(".um-modal-body").find(".um-image-preview"),d=jQuery(r).appendTo(t);d.load(function(){trigger.parents(".um-modal-body").find(".um-modal-btn.um-finish-upload.disabled").removeClass("disabled"),trigger.parents(".um-modal-body").find(".ajax-upload-dragdrop,.filetypetip").hide(0);var e=trigger.data("key"),r=jQuery('[data-gallery_key="'+e+'"]'),t=r.find(".gallery-field").length+1;1==t&&r.html("");var d=t%3==1?"first":t%3==0?"last":"",i='<div class="gallery-field gallery-image-field '+d+" media-id-"+a.id+'"><div class="um-gallery-single-image um-gallery-single"><img src="'+a.src+'">';i+='<div class="preview"><a href="'+a.full+'" data-rel="prettyphoto" class="preview-elem"><i class="um-faicon-photo"></i></a>',i+='<a href="#" class="cancel"><i class="um-faicon-trash"></i></a><div class="um-modal-hidden-content"><div class="um-modal-header">Delete this Photo</div>',i+='<div class="um-modal-body"><div class="um-single-preview"><h3>Are you sure you want to delete this photo?</h3></div>',i+='<div class="um-modal-footer"><div class="um-modal-right"><a href="#" class="um-modal-btn um-confirm-deletion image" data-error="Error" ',i+='data-processing="Deleting..." data-complete="Complete" data-key="'+e+'" data-id="'+a.id+'">Confirm</a>',i+='<a href="#" class="um-modal-btn alt" data-action="um_remove_modal"> Cancel</a></div><div class="um-clear"></div></div></div></div></div></div></div>',r.append(i),jQuery("body").trigger("ulimate_member_gallery_updated"),um_modal_responsive()})})}}),um_modal_responsive()))}),jQuery(document).on("click",".um .um-gallery-single a.cancel",function(e){e.preventDefault();var a="um_upload_single",r=jQuery("body").find(".um-modal-overlay"),t="normal";jQuery("#"+a).html(jQuery(this).parents(".preview").find(".um-modal-hidden-content").html());var r=jQuery("body").find(".um-modal-overlay");return 0==r.length&&(jQuery(".tipsy").hide(),UM_hide_menus(),jQuery("body,html,textarea").css("overflow","hidden"),jQuery(document).bind("touchmove",function(e){e.preventDefault()}),jQuery(".um-modal").on("touchmove",function(e){e.stopPropagation()}),jQuery("body").append('<div class="um-modal-overlay" /><div class="um-modal no-photo" />'),jQuery("#"+a).prependTo(".um-modal"),jQuery("#"+a).show(),jQuery(".um-modal").show(),um_modal_size(t),um_modal_responsive()),!1}),jQuery(document).on("click",".um-confirm-deletion",function(){var e=jQuery(this);e.text(e.data("processing")),jQuery.ajax({url:um_scripts.ajaxurl,type:"post",data:{action:"ultimatemembergallery_remove_file",id:e.data("id"),key:e.data("key")},success:function(a){if(a=jQuery.parseJSON(a),"ok"==a.r){jQuery(".media-id-"+a.id).fadeOut().remove();var r=jQuery('[data-gallery_key="'+a.key+'"]');0==r.find(".gallery-field").length&&r.html('<div class="gallery-field"><div class="um-gallery-single"><p>'+a.empty+"</p></div></div>"),um_remove_modal()}else e.text(e.data("error")+": "+a.r)}})}),jQuery("body").trigger("ulimate_member_gallery_updated")});